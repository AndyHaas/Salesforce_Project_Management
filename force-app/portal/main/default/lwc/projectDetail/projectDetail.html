<template>
    <lightning-card title="Project Detail" class="medium-card">
        <template if:true={projectId}>
            <template if:true={hasData}>
                <div class="page">
                    <div class="header">
                        <div class="title-block">
                            <p class="eyebrow">Project</p>
                            <h2 class="project-name">{project.name}</h2>
                            <p class="meta">Account: {displayAccount}</p>
                        </div>
                        <span class={statusBadgeClass} style={statusBadgeStyle}>{displayStatus}</span>
                    </div>

                    <div class="metrics">
                        <div class="metric">
                            <p class="label">Total Tasks</p>
                            <p class="value">{taskMetrics.totalTasks}</p>
                        </div>
                        <div class="metric">
                            <p class="label">Open Tasks</p>
                            <p class="value">{taskMetrics.openTasks}</p>
                        </div>
                        <div class="metric">
                            <p class="label">Completed</p>
                            <p class="value">{taskMetrics.completedTasks}</p>
                        </div>
                        <div class="metric">
                            <p class="label">Est. Hours</p>
                            <p class="value">{taskMetrics.totalEstimatedHours}</p>
                        </div>
                        <div class="metric">
                            <p class="label">Actual Hours</p>
                            <p class="value">{taskMetrics.totalActualHours}</p>
                        </div>
                        <div class="metric">
                            <p class="label">Burn Rate</p>
                            <p class="value">{displayBurnRate}</p>
                        </div>
                    </div>

                    <div class="details">
                        <div class="detail-item">
                            <span class="label">Invoiced</span>
                            <span class="detail-value">{displayInvoiced}</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">Created</span>
                            <span class="detail-value">{displayCreatedDate}</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">Start Date</span>
                            <span class="detail-value">{displayStartDate}</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">End Date</span>
                            <span class="detail-value">{displayEndDate}</span>
                        </div>
                    </div>
                    
                    <!-- Project Task Files Section -->
                    <template if:true={hasFiles}>
                        <div class="section">
                            <h3 class="section-title">Project Task Files ({filesCount})</h3>
                            <div class="section-content">
                                <div class="files-list">
                                    <template for:each={files} for:item="file">
                                        <div key={file.id} class="file-item">
                                            <lightning-icon icon-name="utility:file" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                            <a href={file.downloadUrl} target="_blank" rel="noopener noreferrer" class="file-link">
                                                {file.title}
                                            </a>
                                            <span class="file-meta">
                                                ({file.formattedSize} â€¢ {file.formattedDate})
                                            </span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Messages Section -->
                    <template if:true={projectId}>
                        <div class="section messages-section">
                            <c-portal-message-feed
                                show-header="true"
                                related-project-id={projectId}
                                limit-count="10"
                                order-by-field="CreatedDate"
                                order-direction="DESC">
                            </c-portal-message-feed>
                            <c-portal-messaging 
                                related-project-id={projectId}>
                            </c-portal-messaging>
                        </div>
                    </template>
                </div>
            </template>

            <template if:true={error}>
                <p class="error">{error}</p>
            </template>

            <template if:true={isLoading}>
                <div class="center">
                    <lightning-spinner alternative-text="Loading project" variant="brand" size="medium"></lightning-spinner>
                </div>
            </template>
        </template>

        <template if:false={projectId}>
            <p class="muted">No project id provided in URL.</p>
        </template>
    </lightning-card>
</template>
