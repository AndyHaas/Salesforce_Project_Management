<template>
    <lightning-card>
        <!-- Custom Header with Gradient -->
        <div slot="header" class="custom-header">
            <lightning-icon icon-name="utility:user" size="large" class="header-icon"></lightning-icon>
            <h1 class="header-title">Welcome to the Portal</h1>
        </div>
        
        <div class="card-body">
            <!-- Identify Step -->
            <template if:true={showIdentifyStep}>
                <div class="slds-text-align_center slds-m-bottom_medium">
                    <h2 class="slds-text-heading_medium">Enter Your Email Address</h2>
                    <p class="slds-text-body_regular slds-m-top_small">
                        We'll send a verification code to your email address.
                    </p>
                </div>

                <lightning-input
                    type="email"
                    label="Email Address"
                    value={email}
                    onchange={handleEmailChange}
                    onkeypress={handleKeyPress}
                    placeholder="Enter your email address"
                    required
                    disabled={isLoading}
                    class="slds-m-bottom_medium">
                </lightning-input>

                <template if:true={errorMessage}>
                    <div class="slds-m-bottom_medium notification notification-error" role="alert">
                        {errorMessage}
                    </div>
                </template>

                <template if:true={successMessage}>
                    <div class="slds-m-bottom_medium notification notification-success" role="alert">
                        {successMessage}
                    </div>
                </template>

                <lightning-button
                    variant="brand"
                    label="Send Code"
                    onclick={handleSendCode}
                    disabled={isLoading}
                    class="slds-m-top_small slds-width_full">
                </lightning-button>
            </template>

            <!-- Verify OTP Step -->
            <template if:true={showVerifyStep}>
                <div class="slds-text-align_center slds-m-bottom_medium">
                    <h2 class="slds-text-heading_medium">Enter Verification Code</h2>
                    <p class="slds-text-body_regular slds-m-top_small">
                        We've sent a verification code to <strong>{email}</strong>
                    </p>
                </div>

                <!-- Sandbox OTP Display -->
                <template if:true={showSandboxOtp}>
                    <div class="slds-m-bottom_medium sandbox-otp-display">
                        <div class="slds-box slds-theme_info">
                            <div class="slds-text-heading_medium slds-text-align_center slds-text-color_success">
                                Your Code: <strong>{displayOtpCode}</strong>
                            </div>
                        </div>
                    </div>
                </template>

                <lightning-input
                    type="text"
                    label="Verification Code"
                    value={otpCode}
                    onchange={handleOTPChange}
                    onkeypress={handleKeyPress}
                    placeholder="Enter 6-digit code"
                    max-length="6"
                    required
                    disabled={isLoading}
                    data-otp-input
                    class="slds-m-bottom_medium">
                </lightning-input>

                <template if:true={errorMessage}>
                    <div class="slds-m-bottom_medium notification notification-error" role="alert">
                        {errorMessage}
                    </div>
                </template>

                <template if:true={successMessage}>
                    <div class="slds-m-bottom_medium notification notification-success" role="alert">
                        {successMessage}
                    </div>
                </template>

                <lightning-button-group class="slds-m-top_medium">
                    <lightning-button
                        variant="neutral"
                        label="Back"
                        onclick={handleBackToIdentify}
                        disabled={isLoading}>
                    </lightning-button>
                    <lightning-button
                        variant="brand"
                        label="Verify & Log In"
                        onclick={handleVerifyAndLogin}
                        disabled={isLoading}>
                    </lightning-button>
                </lightning-button-group>

                <div class="slds-m-top_medium slds-text-align_center">
                    <lightning-button
                        variant="bare"
                        label="Resend Code"
                        onclick={handleResendCode}
                        disabled={isLoading}
                        class="slds-text-link">
                    </lightning-button>
                </div>
            </template>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <div class="loading-container">
                    <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
                </div>
            </template>
        </div>
    </lightning-card>
</template>
