<template>
    <lightning-card title="Project Management Portal Login" icon-name="utility:user">
        <div class="slds-p-around_medium">
            <!-- Email Step -->
            <template if:true={showEmailStep}>
                <div class="slds-text-align_center slds-m-bottom_medium">
                    <h2 class="slds-text-heading_medium">Enter Your Email Address</h2>
                    <p class="slds-text-body_regular slds-m-top_small">
                        We'll send a verification code to your email address.
                    </p>
                </div>

                <lightning-input
                    type="email"
                    label="Email Address"
                    value={email}
                    onchange={handleEmailChange}
                    onkeypress={handleKeyPress}
                    placeholder="Enter your email address"
                    required
                    class="slds-m-bottom_medium">
                </lightning-input>

                <template if:true={errorMessage}>
                    <div class="slds-m-bottom_small">
                        <lightning-formatted-text
                            value={errorMessage}
                            class="slds-text-color_error">
                        </lightning-formatted-text>
                    </div>
                </template>

                <template if:true={successMessage}>
                    <div class="slds-m-bottom_small">
                        <lightning-formatted-text
                            value={successMessage}
                            class="slds-text-color_success">
                        </lightning-formatted-text>
                    </div>
                </template>

                <lightning-button
                    variant="brand"
                    label="Send Verification Code"
                    onclick={handleEmailSubmit}
                    disabled={isLoading}
                    class="slds-m-top_small slds-width_full">
                </lightning-button>
            </template>

            <!-- OTP Step -->
            <template if:true={showOTPStep}>
                <div class="slds-text-align_center slds-m-bottom_medium">
                    <h2 class="slds-text-heading_medium">Enter Verification Code</h2>
                    <p class="slds-text-body_regular slds-m-top_small">
                        We've sent a 6-digit verification code to <strong>{email}</strong>
                    </p>
                </div>

                <lightning-input
                    type="text"
                    label="Verification Code"
                    value={otpCode}
                    onchange={handleOTPChange}
                    onkeypress={handleKeyPress}
                    placeholder="Enter 6-digit code"
                    max-length="6"
                    required
                    class="slds-m-bottom_medium">
                </lightning-input>

                <template if:true={errorMessage}>
                    <div class="slds-m-bottom_small">
                        <lightning-formatted-text
                            value={errorMessage}
                            class="slds-text-color_error">
                        </lightning-formatted-text>
                    </div>
                </template>

                <template if:true={successMessage}>
                    <div class="slds-m-bottom_small">
                        <lightning-formatted-text
                            value={successMessage}
                            class="slds-text-color_success">
                        </lightning-formatted-text>
                    </div>
                </template>

                <div class="slds-grid slds-gutters slds-m-top_small">
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-button
                            variant="neutral"
                            label="Back"
                            onclick={handleBackToEmail}
                            disabled={isLoading}
                            class="slds-width_full">
                        </lightning-button>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-button
                            variant="brand"
                            label="Verify & Login"
                            onclick={handleOTPSubmit}
                            disabled={isLoading}
                            class="slds-width_full">
                        </lightning-button>
                    </div>
                </div>

                <div class="slds-m-top_medium slds-text-align_center">
                    <lightning-button
                        variant="bare"
                        label="Resend Code"
                        onclick={handleResendOTP}
                        disabled={isLoading}
                        class="slds-text-link">
                    </lightning-button>
                </div>
            </template>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <div class="slds-is-relative slds-m-top_medium" style="height: 50px;">
                    <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
                </div>
            </template>
        </div>
    </lightning-card>
</template>

